
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://opendsm.energy/documentation/eemeter/billing_model/example/">
      
      
        <link rel="prev" href="../methodology/">
      
      
        <link rel="next" href="../api/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.29">
    
    
      
        <title>Example - OpenDSM</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.76a95c52.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/custom.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#imports" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="OpenDSM" class="md-header__button md-logo" aria-label="OpenDSM" data-md-component="logo">
      
  <img src="https://opendsm.github.io/opendsm-website/assets/images/common/opendsm-icon-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            OpenDSM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Example
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="indigo"  aria-label="Switch to light mod"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mod" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../install/" class="md-tabs__link">
        
  
    
  
  Install

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../" class="md-tabs__link">
        
  
    
  
  Documentation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../community/" class="md-tabs__link">
        
  
    
  
  Community

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="OpenDSM" class="md-nav__button md-logo" aria-label="OpenDSM" data-md-component="logo">
      
  <img src="https://opendsm.github.io/opendsm-website/assets/images/common/opendsm-icon-white.svg" alt="logo">

    </a>
    OpenDSM
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../history/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    History
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../philosophy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Philosophy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../general_concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    OpenEEmeter
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            OpenEEmeter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_1" >
        
          
          <label class="md-nav__link" for="__nav_3_4_1" id="__nav_3_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hourly Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_1">
            <span class="md-nav__icon md-icon"></span>
            Hourly Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hourly_model/methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hourly_model/example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hourly_model/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hourly_model/references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Daily Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            Daily Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../daily_model/methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../daily_model/example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../daily_model/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../daily_model/references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Billing Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Billing Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Example
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Example
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-data" class="md-nav__link">
    <span class="md-ellipsis">
      Loading data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loading data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-notes-about-data" class="md-nav__link">
    <span class="md-ellipsis">
      Important notes about data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-data-into-eemeter-data-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data into EEmeter Data Objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predicting-with-the-model-and-calculating-savings" class="md-nav__link">
    <span class="md-ellipsis">
      Predicting with the Model and Calculating Savings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      Model Serialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-sufficiency-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Sufficiency Checking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-code" class="md-nav__link">
    <span class="md-ellipsis">
      Example Code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../drmeter/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    DRmeter
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            DRmeter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5_1" >
        
          
          <label class="md-nav__link" for="__nav_3_5_1" id="__nav_3_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CalTRACK Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5_1">
            <span class="md-nav__icon md-icon"></span>
            CalTRACK Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../drmeter/caltrack_model/methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../drmeter/caltrack_model/example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../drmeter/caltrack_model/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../drmeter/caltrack_model/references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../drmeter/new_model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    New Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    <span class="md-ellipsis">
      Imports
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-data" class="md-nav__link">
    <span class="md-ellipsis">
      Loading data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loading data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#important-notes-about-data" class="md-nav__link">
    <span class="md-ellipsis">
      Important notes about data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loading-data-into-eemeter-data-objects" class="md-nav__link">
    <span class="md-ellipsis">
      Loading Data into EEmeter Data Objects
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-model" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the Model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#predicting-with-the-model-and-calculating-savings" class="md-nav__link">
    <span class="md-ellipsis">
      Predicting with the Model and Calculating Savings
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model-serialization" class="md-nav__link">
    <span class="md-ellipsis">
      Model Serialization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automatic-sufficiency-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Automatic Sufficiency Checking
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-code" class="md-nav__link">
    <span class="md-ellipsis">
      Example Code
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Example</h1>

<p>In this example, we'll walk through creating a Billing Model and predicting usage with it.</p>
<p>You can find a working example in the <a href="#example-code">Example Code</a> at the bottom of the page.</p>
<p><span style="font-size: 0.9em;">
1) This example makes use of Matplotlib. Matplotlib is not a required dependency of OpenDSM.<br>
2) If you run this example, it will download up to 150 MB of example data from the GitHub repo.
</span></p>
<h3 id="imports">Imports<a class="headerlink" href="#imports" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">opendsm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">odsm</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opendsm</span><span class="w"> </span><span class="kn">import</span> <span class="n">eemeter</span> <span class="k">as</span> <span class="n">em</span>
</code></pre></div>
<h3 id="loading-data">Loading data<a class="headerlink" href="#loading-data" title="Permanent link">&para;</a></h3>
<p>The essential inputs to OpenDSM library functions are the following:</p>
<ol>
<li>Meter baseline data named <code>observed</code></li>
<li>Meter reporting data <code>observed</code></li>
<li>Temperature data from a nearby weather station for both named <code>temperature</code></li>
<li>All data is expected to have a timezone-aware datetime index or column named <code>datetime</code></li>
</ol>
<p>Users of the library are responsible for obtaining and formatting this data (to get weather data, see <a href="https://github.com/opendsm/eeweather">EEweather</a>, which helps perform site to weather station matching and can pull and cache temperature data directly from public (US) data sources).</p>
<p>We utilize data classes to store meter data, perform transforms, and validate the data to ensure data compliance. The inputs into these data classes can either be <a href="https://pandas.pydata.org/">pandas</a> <code>DataFrame</code> if initializing the classes directly or <code>Series</code> if initializing the classes using <code>.from_series</code>.</p>
<p>The test data contained within the OpenDSM library is derived from <a href="https://comstock.nrel.gov/">NREL ComStock</a> simulations.</p>
<p>If working with your own data instead of these samples, please refer directly to the excellent pandas documentation for instructions for loading data (e.g., <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">pandas.read_csv</a>).</p>
<h4 id="important-notes-about-data">Important notes about data<a class="headerlink" href="#important-notes-about-data" title="Permanent link">&para;</a></h4>
<ul>
<li><em>These models were developed and tested using Fahrenheit temperature. Please convert your temperatures accordingly</em></li>
<li><em>It is expected that all data is trimmed to its appropriate time period (baseline and reporting) and does not contain extraneous datetimes</em></li>
</ul>
<p>Let us begin by loading some example data. Here we use a built-in utility function to load some example data.</p>
<p>This function returns two dataframes of monthly billing electricity data, one for the baseline period and one for the reporting period.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">df_baseline</span><span class="p">,</span> <span class="n">df_reporting</span> <span class="o">=</span>  <span class="n">odsm</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">load_test_data</span><span class="p">(</span><span class="s2">&quot;monthly_treatment_data&quot;</span><span class="p">)</span>
</code></pre></div>
<p>If we inspect these dataframes, we will notice that there are 100 meters for you to experiment with, indexed by meter id and datetime.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">df_baseline</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>id      datetime                   temperature       observed
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>108618  2018-01-01 00:00:00-06:00    -2.384038  257406.539278
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>        2018-01-02 00:00:00-06:00     1.730000            NaN
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>        2018-01-03 00:00:00-06:00    13.087946            NaN
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>        2018-01-04 00:00:00-06:00     4.743269            NaN
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        2018-01-05 00:00:00-06:00     4.130577            NaN
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>                              ...          ...            ...
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>120841  2018-12-27 00:00:00-06:00    52.010625            NaN
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>        2018-12-28 00:00:00-06:00    35.270000            NaN
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        2018-12-29 00:00:00-06:00    29.630000            NaN
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        2018-12-30 00:00:00-06:00    34.250000            NaN
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        2018-12-31 00:00:00-06:00    43.311250            NaN
</code></pre></div>
</details>
<p>Notice that there is only a single observed value and the rest are NaN. This is because these are daily average temperatures and only 12 data points out of the year have observed values. This is prior to the observed averaging that will take place later.</p>
<p>To simplify things, we will filter down to a single meter for the rest of the example. Let's filter down to the 15th id.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">15</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nb">id</span> <span class="o">=</span> <span class="n">df_baseline</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="n">n</span><span class="p">]</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">df_baseline_n</span> <span class="o">=</span> <span class="n">df_baseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="n">df_reporting_n</span> <span class="o">=</span> <span class="n">df_reporting</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
</code></pre></div>
<p>If we inspect one of these dataframes, we will now notice that only a single meter is present with 365 days of data in each dataframe. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">df_baseline_n</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>datetime                   temperature       observed
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>2018-01-01 00:00:00-06:00   -10.045000  143527.500929
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>2018-01-02 00:00:00-06:00    -4.712500            NaN
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>2018-01-03 00:00:00-06:00    11.352500            NaN
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>2018-01-04 00:00:00-06:00     0.972500            NaN
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>2018-01-05 00:00:00-06:00     3.147500            NaN
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>...                                ...            ...
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>2018-12-27 00:00:00-06:00    46.760000            NaN
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>2018-12-28 00:00:00-06:00    35.323125            NaN
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>2018-12-29 00:00:00-06:00    26.386250            NaN
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>2018-12-30 00:00:00-06:00    28.463750            NaN
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>2018-12-31 00:00:00-06:00    40.345250            NaN
</code></pre></div>
</details>
<p>Also notice the general structure of these dataframes for a single meter. We have three columns:</p>
<ol>
<li>A timezone-aware datetime index.</li>
<li>A temperature column (float) in Fahrenheit (be sure to convert any other units to Fahrenheit first) and must be at least daily interval data.</li>
<li>Observed meter usage (float). The example here is electricity data in kWh, but it could also be gas data.</li>
<li>Billing data is reversed from a customer perspective. From a customer perspective, you pay for the month you used energy and so the bill is for the month prior. To model this, the start date should have the usage for a given month</li>
</ol>
<p>We can stop to plot this data to get a better understanding of the general behavior of this meter.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Datetime&#39;</span><span class="p">)</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed Usage&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_baseline_n</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_baseline_n</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed Usage&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (F)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_baseline_n</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_baseline_n</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature (F)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Observed Usage and Temperature in the Baseline Period&#39;</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<p><div style="text-align: center; margin-top: 30px">
    <img src="/assets/images/eemeter/billing_model/example/baseline_data_billing.png" alt="Billing Baseline Data">
</div></p>
</details>
<p>If we observe the data we can see a full year of data with observed usage peaking in the winter and lowering in the summer with warmer temperatures. It's clear that this site is located in a colder climate and uses more electricity in the winter.</p>
<h3 id="loading-data-into-eemeter-data-objects">Loading Data into EEmeter Data Objects<a class="headerlink" href="#loading-data-into-eemeter-data-objects" title="Permanent link">&para;</a></h3>
<p>With our sample data loaded into dataframes, we can create our Baseline and Reporting Data objects. Note that only the baseline period is needed to fit a model, but we will use our reporting period data to predict against.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">baseline_data</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingBaselineData</span><span class="p">(</span><span class="n">df_baseline_n</span><span class="p">,</span> <span class="n">is_electricity_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">reporting_data</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingReportingData</span><span class="p">(</span><span class="n">df_reporting_n</span><span class="p">,</span> <span class="n">is_electricity_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>These classes are critical to ensure standardized data loaded into the model. As with the daily model, these classes scan the data to check for data sufficiency and other criteria that might cause a model to be disqualified (unable to build a model of sufficient integrity). </p>
<p>In the case of the billing model, these classes also perform the observed averaging over the billing period. Let's see what this looks like.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">print</span><span class="p">(</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>datetime                   season weekday_weekend  temperature     observed
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>2018-01-01 00:00:00-06:00  winter         weekday   -10.045000  4629.919385
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>2018-01-02 00:00:00-06:00  winter         weekday    -4.712500  4629.919385
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>2018-01-03 00:00:00-06:00  winter         weekday    11.352500  4629.919385
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>2018-01-04 00:00:00-06:00  winter         weekday     0.972500  4629.919385
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>2018-01-05 00:00:00-06:00  winter         weekday     3.147500  4629.919385
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>...                           ...             ...          ...          ...
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>2018-12-27 00:00:00-06:00  winter         weekday    46.760000  3312.268813
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>2018-12-28 00:00:00-06:00  winter         weekday    35.323125  3312.268813
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>2018-12-29 00:00:00-06:00  winter         weekend    26.386250  3312.268813
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>2018-12-30 00:00:00-06:00  winter         weekend    28.463750  3312.268813
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>2018-12-31 00:00:00-06:00  winter         weekday    40.345250  3312.268813
</code></pre></div>
</details>
<p>As these classes are derived from the daily data classes, season and weekday_weekend are still computed, but the biggest change from what we saw previously is that the observed column appears to be completely filled out. If you were to sum up the observed values over a given billing period it would equal the results of the input data. Let's see how this looks compared to the last plot.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Datetime&#39;</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Observed Usage&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">baseline_data</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed Usage&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;orange&#39;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (F)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">baseline_data</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;temperature&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Temperature (F)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Observed Usage and Temperature in the Baseline Period&#39;</span><span class="p">)</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<p><div style="text-align: center; margin-top: 30px">
    <img src="/assets/images/eemeter/billing_model/example/baseline_data_daily.png" alt="Billing Baseline Data Averaged">
</div></p>
</details>
<p>In this plot the observed usage is now continuous in time with discontinuities where the billing periods change.</p>
<p>With data classes successfully instantiated, we can also check for any disqualifications or warnings before moving on to the model fitting step.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disqualifications: </span><span class="si">{</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">disqualification</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warnings:          </span><span class="si">{</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">warnings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Disqualifications: []
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>Warnings:          [EEMeterWarning(qualified_name=eemeter.sufficiency_criteria.unable_to_confirm_daily_temperature_sufficiency)]
</code></pre></div>
</details>
<p>From this, we can see that no disqualifications are present but there are some warnings to be aware of as we proceed. Warnings will necessarily stop us from creating a model.</p>
<h3 id="creating-the-model">Creating the Model<a class="headerlink" href="#creating-the-model" title="Permanent link">&para;</a></h3>
<p>The billing model follows the general process of:</p>
<ol>
<li>Initialize</li>
<li>Fit</li>
<li>Predict</li>
</ol>
<p>We can do this easily as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">billing_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="p">()</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">)</span>
</code></pre></div>
<p>Before we move to predicting against a dataframe, we can actually use the built in plot function (requiring Matplotlib) to plot the performance of the model against the provided data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<p><div style="text-align: center; margin-top: 30px">
    <img src="/assets/images/eemeter/billing_model/example/daily_baseline_vs_model.png" alt="Daily Baseline Observed vs. Model">
</div></p>
</details>
<p>It's not always very intuitive to input billing data and then to see daily plots, so the plot function has an optional input where you can specify <code>monthly</code> or <code>bimonthly</code> to aggregate to the specified interval.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<p><div style="text-align: center; margin-top: 30px">
    <img src="/assets/images/eemeter/billing_model/example/billing_baseline_vs_model.png" alt="Monthly Baseline Observed vs. Model">
</div></p>
</details>
<p>While it might initially be concerning that this model does not appear to look like any of the <a href="/documentation/eemeter/billing_model/methodology/#model-archetypes">Model Archetypes</a>, remember that this is utilizing the daily model under the hood. We've found through extensive testing that this model is more accurate than a CalTRACK model that does follow those model archetypes on a billing interval basis (<a href="/documentation/eemeter/billing_model/references/">References pg. 28</a>).</p>
<p>We can also use this function to plot the model prediction against the reporting period as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reporting_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<p><div style="text-align: center; margin-top: 30px">
    <img src="/assets/images/eemeter/billing_model/example/billing_reporting_vs_model.png" alt="Monthly Reporting Observed vs. Model">
</div></p>
</details>
<p>In this plot we can see that the site is using significantly less energy in colder temperatures compared to the model / baseline period. Perhaps this site installed an efficiency intervention that saves energy in colder temperatures?</p>
<h3 id="predicting-with-the-model-and-calculating-savings">Predicting with the Model and Calculating Savings<a class="headerlink" href="#predicting-with-the-model-and-calculating-savings" title="Permanent link">&para;</a></h3>
<p>With our fit model, we can now predict across a given reporting period. The billing model predict method has the same functionality as the plot function. Let's skip straight to using that.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">df_results</span> <span class="o">=</span> <span class="n">billing_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">reporting_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">df_results</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>datetime                     season  temperature      observed      predicted  predicted_unc  heating_load  cooling_load  model_split model_type
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>2019-01-01 00:00:00-06:00    winter    23.684855  83259.561689  113204.189203    4817.570659  41972.011102           0.0  fw-su_sh_wi   hdd_tidd
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>2019-02-01 00:00:00-06:00    winter    32.858562  59500.977283   94352.449401    4578.532084  30013.707891           0.0  fw-su_sh_wi   hdd_tidd
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>2019-03-01 00:00:00-06:00  shoulder    37.632207  59374.674004   99912.353102    4817.570659  28680.175001           0.0  fw-su_sh_wi   hdd_tidd
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>2019-04-01 00:00:00-05:00  shoulder    45.590826  55628.416668   89349.469105    4739.230955  20415.103201           0.0  fw-su_sh_wi   hdd_tidd
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>2019-05-01 00:00:00-05:00  shoulder    72.356294  67624.123278   71439.541663    4817.570659    207.363562           0.0  fw-su_sh_wi   hdd_tidd
</code></pre></div>
</details>
<p>From here, we can easily calculate savings by subtracting observed usage from predicted usage.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;savings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted Usage (kWh):  </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Observed Usage (kWh):   </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Savings (kWh):          </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;savings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>Predicted Usage (kWh):  1038677.49
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>Observed Usage (kWh):    789252.05
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>Savings (kWh):           249425.45
</code></pre></div>
</details>
<h3 id="model-serialization">Model Serialization<a class="headerlink" href="#model-serialization" title="Permanent link">&para;</a></h3>
<p>After creating a model, we can also serialize it for storage and read it back in later.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">saved_model</span> <span class="o">=</span> <span class="n">billing_model</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="nb">print</span><span class="p">(</span><span class="n">saved_model</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">{</span><span class="s2">&quot;submodels&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;fw-su_sh_wi&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;coefficients&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;hdd_tidd&quot;</span><span class="p">,</span> <span class="s2">&quot;intercept&quot;</span><span class="p">:</span> <span class="mf">2297.8121967963853</span><span class="p">,</span> <span class="s2">&quot;hdd_bp&quot;</span><span class="p">:</span> <span class="mf">67.72680897508171</span><span class="p">,</span> <span class="s2">&quot;hdd_beta&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">30.741956585408087</span><span class="p">,</span> <span class="s2">&quot;hdd_k&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cdd_bp&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cdd_beta&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> <span class="s2">&quot;cdd_k&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">},</span> <span class="s2">&quot;temperature_constraints&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;T_min&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">10.045</span><span class="p">,</span> <span class="s2">&quot;T_max&quot;</span><span class="p">:</span> <span class="mf">83.00500000000001</span><span class="p">,</span> <span class="s2">&quot;T_min_seg&quot;</span><span class="p">:</span> <span class="mf">12.545</span><span class="p">,</span> <span class="s2">&quot;T_max_seg&quot;</span><span class="p">:</span> <span class="mf">81.155</span><span class="p">},</span> <span class="s2">&quot;f_unc&quot;</span><span class="p">:</span> <span class="mf">865.2612331776701</span><span class="p">}},</span> <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;num_model_params&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;wrmse&quot;</span><span class="p">:</span> <span class="mf">419.24394756674826</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mi">365</span><span class="p">,</span> <span class="s2">&quot;n_prime&quot;</span><span class="p">:</span> <span class="mf">27.66964273507515</span><span class="p">,</span> <span class="s2">&quot;ddof&quot;</span><span class="p">:</span> <span class="mi">362</span><span class="p">,</span> <span class="s2">&quot;ddof_autocorr&quot;</span><span class="p">:</span> <span class="mf">24.66964273507515</span><span class="p">,</span> <span class="s2">&quot;observed&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="mf">1038753.1599362098</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">2845.899068318383</span><span class="p">,</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span> <span class="mf">488312.02991311357</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="mf">698.7932669345875</span><span class="p">,</span> <span class="s2">&quot;cvstd&quot;</span><span class="p">:</span> <span class="mf">0.24554393889573123</span><span class="p">,</span> <span class="s2">&quot;sum_squared&quot;</span><span class="p">:</span> <span class="mf">3134420540.9935226</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="mf">2429.3228342442544</span><span class="p">,</span> <span class="s2">&quot;MAD_scaled&quot;</span><span class="p">:</span> <span class="mf">333.1117536358844</span><span class="p">,</span> <span class="s2">&quot;iqr&quot;</span><span class="p">:</span> <span class="mf">926.6745388691215</span><span class="p">,</span> <span class="s2">&quot;skew&quot;</span><span class="p">:</span> <span class="mf">1.2625298968979632</span><span class="p">,</span> <span class="s2">&quot;kurtosis&quot;</span><span class="p">:</span> <span class="mf">0.9156722074740755</span><span class="p">},</span> <span class="s2">&quot;predicted&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="mf">1038737.259890548</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">2845.8555065494465</span><span class="p">,</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span> <span class="mf">312476.71880654804</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="mf">558.996170654637</span><span class="p">,</span> <span class="s2">&quot;cvstd&quot;</span><span class="p">:</span> <span class="mf">0.19642464958890718</span><span class="p">,</span> <span class="s2">&quot;sum_squared&quot;</span><span class="p">:</span> <span class="mf">3070150153.281991</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="mf">2788.524855779726</span><span class="p">,</span> <span class="s2">&quot;MAD_scaled&quot;</span><span class="p">:</span> <span class="mf">698.6505031914634</span><span class="p">,</span> <span class="s2">&quot;iqr&quot;</span><span class="p">:</span> <span class="mf">966.0076038629841</span><span class="p">,</span> <span class="s2">&quot;skew&quot;</span><span class="p">:</span> <span class="mf">0.7165071708387074</span><span class="p">,</span> <span class="s2">&quot;kurtosis&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2538771406240987</span><span class="p">},</span> <span class="s2">&quot;residuals&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;sum&quot;</span><span class="p">:</span> <span class="mf">15.900045661750482</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span> <span class="mf">0.04356176893630269</span><span class="p">,</span> <span class="s2">&quot;variance&quot;</span><span class="p">:</span> <span class="mf">175765.48567372267</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="mf">419.2439453035937</span><span class="p">,</span> <span class="s2">&quot;cvstd&quot;</span><span class="p">:</span> <span class="mf">9624.125822728289</span><span class="p">,</span> <span class="s2">&quot;sum_squared&quot;</span><span class="p">:</span> <span class="mf">64154402.963542886</span><span class="p">,</span> <span class="s2">&quot;median&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">5.880697581936602</span><span class="p">,</span> <span class="s2">&quot;MAD_scaled&quot;</span><span class="p">:</span> <span class="mf">181.868534696836</span><span class="p">,</span> <span class="s2">&quot;iqr&quot;</span><span class="p">:</span> <span class="mf">242.47336933796623</span><span class="p">,</span> <span class="s2">&quot;skew&quot;</span><span class="p">:</span> <span class="mf">1.6831253772500656</span><span class="p">,</span> <span class="s2">&quot;kurtosis&quot;</span><span class="p">:</span> <span class="mf">4.7581863103152955</span><span class="p">},</span> <span class="s2">&quot;max_error&quot;</span><span class="p">:</span> <span class="mf">1769.9811033304532</span><span class="p">,</span> <span class="s2">&quot;mae&quot;</span><span class="p">:</span> <span class="mf">257.92400477097476</span><span class="p">,</span> <span class="s2">&quot;nmae&quot;</span><span class="p">:</span> <span class="mf">0.09063006051137991</span><span class="p">,</span> <span class="s2">&quot;pnmae&quot;</span><span class="p">:</span> <span class="mf">0.2783328924583764</span><span class="p">,</span> <span class="s2">&quot;medae&quot;</span><span class="p">:</span> <span class="mf">128.54916011813293</span><span class="p">,</span> <span class="s2">&quot;mbe&quot;</span><span class="p">:</span> <span class="mf">0.04356176893630269</span><span class="p">,</span> <span class="s2">&quot;nmbe&quot;</span><span class="p">:</span> <span class="mf">1.530685659981714e-05</span><span class="p">,</span> <span class="s2">&quot;pnmbe&quot;</span><span class="p">:</span> <span class="mf">4.700870382115367e-05</span><span class="p">,</span> <span class="s2">&quot;sse&quot;</span><span class="p">:</span> <span class="mf">64154402.963542886</span><span class="p">,</span> <span class="s2">&quot;mse&quot;</span><span class="p">:</span> <span class="mf">175765.4875713504</span><span class="p">,</span> <span class="s2">&quot;rmse&quot;</span><span class="p">:</span> <span class="mf">419.24394756674826</span><span class="p">,</span> <span class="s2">&quot;rmse_autocorr&quot;</span><span class="p">:</span> <span class="mf">1522.6898682446667</span><span class="p">,</span> <span class="s2">&quot;rmse_adj&quot;</span><span class="p">:</span> <span class="mf">420.9775619128606</span><span class="p">,</span> <span class="s2">&quot;rmse_autocorr_adj&quot;</span><span class="p">:</span> <span class="mf">1612.619116623234</span><span class="p">,</span> <span class="s2">&quot;cvrmse&quot;</span><span class="p">:</span> <span class="mf">0.14731511466233266</span><span class="p">,</span> <span class="s2">&quot;cvrmse_autocorr&quot;</span><span class="p">:</span> <span class="mf">0.535047038454674</span><span class="p">,</span> <span class="s2">&quot;cvrmse_adj&quot;</span><span class="p">:</span> <span class="mf">0.14792427693565838</span><span class="p">,</span> <span class="s2">&quot;cvrmse_autocorr_adj&quot;</span><span class="p">:</span> <span class="mf">0.5666466300845014</span><span class="p">,</span> <span class="s2">&quot;pnrmse&quot;</span><span class="p">:</span> <span class="mf">0.45241768278038336</span><span class="p">,</span> <span class="s2">&quot;pnrmse_autocorr&quot;</span><span class="p">:</span> <span class="mf">1.6431765462153516</span><span class="p">,</span> <span class="s2">&quot;pnrmse_adj&quot;</span><span class="p">:</span> <span class="mf">0.45428847373599546</span><span class="p">,</span> <span class="s2">&quot;pnrmse_autocorr_adj&quot;</span><span class="p">:</span> <span class="mf">1.7402216732869484</span><span class="p">,</span> <span class="s2">&quot;r_squared&quot;</span><span class="p">:</span> <span class="mf">0.6400549832773262</span><span class="p">,</span> <span class="s2">&quot;r_squared_adj&quot;</span><span class="p">:</span> <span class="mf">0.6370637504513761</span><span class="p">,</span> <span class="s2">&quot;mape&quot;</span><span class="p">:</span> <span class="mf">0.08155878354581031</span><span class="p">,</span> <span class="s2">&quot;smape&quot;</span><span class="p">:</span> <span class="mf">0.08173992723397144</span><span class="p">,</span> <span class="s2">&quot;wape&quot;</span><span class="p">:</span> <span class="mf">0.09063006051137991</span><span class="p">,</span> <span class="s2">&quot;swape&quot;</span><span class="p">:</span> <span class="mf">0.09063075414735854</span><span class="p">,</span> <span class="s2">&quot;maape&quot;</span><span class="p">:</span> <span class="mf">0.08048769260024743</span><span class="p">,</span> <span class="s2">&quot;nse&quot;</span><span class="p">:</span> <span class="mf">0.6400549714029681</span><span class="p">,</span> <span class="s2">&quot;nnse&quot;</span><span class="p">:</span> <span class="mf">0.7353238395463939</span><span class="p">,</span> <span class="s2">&quot;kge&quot;</span><span class="p">:</span> <span class="mf">0.7171513388922812</span><span class="p">,</span> <span class="s2">&quot;a10&quot;</span><span class="p">:</span> <span class="mf">0.726027397260274</span><span class="p">,</span> <span class="s2">&quot;a20&quot;</span><span class="p">:</span> <span class="mf">0.8767123287671232</span><span class="p">,</span> <span class="s2">&quot;a30&quot;</span><span class="p">:</span> <span class="mf">0.9643835616438357</span><span class="p">,</span> <span class="s2">&quot;wi&quot;</span><span class="p">:</span> <span class="mf">0.8794028739871067</span><span class="p">,</span> <span class="s2">&quot;index_of_agreement&quot;</span><span class="p">:</span> <span class="mf">0.7770521795412928</span><span class="p">,</span> <span class="s2">&quot;pearson_r&quot;</span><span class="p">:</span> <span class="mf">0.8000343638102831</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="mf">0.7035525188232095</span><span class="p">,</span> <span class="s2">&quot;pi_rating&quot;</span><span class="p">:</span> <span class="s2">&quot;good&quot;</span><span class="p">,</span> <span class="s2">&quot;explained_variance_score&quot;</span><span class="p">:</span> <span class="mf">0.6400549752890646</span><span class="p">},</span> <span class="s2">&quot;baseline_timezone&quot;</span><span class="p">:</span> <span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;disqualification&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;qualified_name&quot;</span><span class="p">:</span> <span class="s2">&quot;eemeter.sufficiency_criteria.unable_to_confirm_daily_temperature_sufficiency&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot confirm that pre-aggregated temperature data had sufficient hours kept&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{}}]},</span> <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;developer_mode&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;algorithm_choice&quot;</span><span class="p">:</span> <span class="s2">&quot;nlopt_sbplx&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_guess_algorithm_choice&quot;</span><span class="p">:</span> <span class="s2">&quot;nlopt_direct&quot;</span><span class="p">,</span> <span class="s2">&quot;full_model&quot;</span><span class="p">:</span> <span class="s2">&quot;hdd_tidd_cdd&quot;</span><span class="p">,</span> <span class="s2">&quot;allow_smooth_model&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;alpha_minimum&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;alpha_selection&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;alpha_final_type&quot;</span><span class="p">:</span> <span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha_final&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;final_bounds_scalar&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;regularization_alpha&quot;</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;regularization_percent_lasso&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;segment_minimum_count&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;maximum_slope_oom_scalar&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;initial_step_percentage&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;split_selection&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;criteria&quot;</span><span class="p">:</span> <span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="s2">&quot;penalty_multiplier&quot;</span><span class="p">:</span> <span class="mf">0.24</span><span class="p">,</span> <span class="s2">&quot;penalty_power&quot;</span><span class="p">:</span> <span class="mf">2.061</span><span class="p">,</span> <span class="s2">&quot;allow_separate_summer&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;allow_separate_shoulder&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;allow_separate_winter&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;allow_separate_weekday_weekend&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;reduce_splits_by_gaussian&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span> <span class="s2">&quot;reduce_splits_num_std&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">},</span> <span class="s2">&quot;season&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;january&quot;</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;february&quot;</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;march&quot;</span><span class="p">:</span> <span class="s2">&quot;shoulder&quot;</span><span class="p">,</span> <span class="s2">&quot;april&quot;</span><span class="p">:</span> <span class="s2">&quot;shoulder&quot;</span><span class="p">,</span> <span class="s2">&quot;may&quot;</span><span class="p">:</span> <span class="s2">&quot;shoulder&quot;</span><span class="p">,</span> <span class="s2">&quot;june&quot;</span><span class="p">:</span> <span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;july&quot;</span><span class="p">:</span> <span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;august&quot;</span><span class="p">:</span> <span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;september&quot;</span><span class="p">:</span> <span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;october&quot;</span><span class="p">:</span> <span class="s2">&quot;shoulder&quot;</span><span class="p">,</span> <span class="s2">&quot;november&quot;</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;december&quot;</span><span class="p">:</span> <span class="s2">&quot;winter&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="s2">&quot;shoulder&quot;</span><span class="p">,</span> <span class="s2">&quot;winter&quot;</span><span class="p">]},</span> <span class="s2">&quot;weekday_weekend&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;monday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;tuesday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;wednesday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;thursday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;friday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;saturday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;sunday&quot;</span><span class="p">:</span> <span class="s2">&quot;weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;weekday&quot;</span><span class="p">,</span> <span class="s2">&quot;weekend&quot;</span><span class="p">]},</span> <span class="s2">&quot;uncertainty_alpha&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;cvrmse_threshold&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;pnrmse_threshold&quot;</span><span class="p">:</span> <span class="mf">1.6</span><span class="p">}}</span>
</code></pre></div>
</details>
<p>Afterwards, we can instantiate the model as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">loaded_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">saved_model</span><span class="p">)</span>
</code></pre></div>
<h3 id="automatic-sufficiency-checking">Automatic Sufficiency Checking<a class="headerlink" href="#automatic-sufficiency-checking" title="Permanent link">&para;</a></h3>
<p>Two of the core features of the OpenDSM Data and Model classes are automatic data sufficiency and model sufficiency checking. This ensures that only acceptable data and models are allowed to be used for making measurements. Let's show an example of how this works by introducing too many NaN values into the observed data of the prior example.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># set rows 1:38 of observed to nan</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">df_baseline_n_dq</span> <span class="o">=</span> <span class="n">df_baseline_n</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">df_baseline_n_dq</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_baseline_n_dq</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">38</span><span class="p">],</span> <span class="s2">&quot;observed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">baseline_data_DQ</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingBaselineData</span><span class="p">(</span><span class="n">df_baseline_n_dq</span><span class="p">,</span> <span class="n">is_electricity_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disqualifications: </span><span class="si">{</span><span class="n">baseline_data_DQ</span><span class="o">.</span><span class="n">disqualification</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">Disqualifications</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="n">EEMeterWarning</span><span class="p">(</span><span class="n">qualified_name</span><span class="o">=</span><span class="n">eemeter</span><span class="o">.</span><span class="n">sufficiency_criteria</span><span class="o">.</span><span class="n">offcycle_reads_in_billing_monthly_data</span><span class="p">),</span> 
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="n">EEMeterWarning</span><span class="p">(</span><span class="n">qualified_name</span><span class="o">=</span><span class="n">eemeter</span><span class="o">.</span><span class="n">sufficiency_criteria</span><span class="o">.</span><span class="n">incorrect_number_of_total_days</span><span class="p">)</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="p">]</span>
</code></pre></div>
</details>
<p>If this data were to try to be fit on it would return an error by default.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>    <span class="n">billing_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">baseline_data_DQ</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<details class="returns">
<summary>Returns</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="ne">Exception</span><span class="p">:</span> <span class="n">Can</span><span class="s1">&#39;t fit model on disqualified baseline data</span>
</code></pre></div>
</details>
<p>In some circumstances it may still be possible to fit a model on disqualified data for investigative purposes. This can be done by setting the <code>ignore_disqualification</code> flag to True.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">billing_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">baseline_data_DQ</span><span class="p">,</span> <span class="n">ignore_disqualification</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<p>Please remember that enabling <code>ignore_disqualification</code> or making any changes to the model configuration fundamentally alters the model and such models are <strong>not approved for measurement purposes</strong>.</p>
<h2 id="example-code">Example Code<a class="headerlink" href="#example-code" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">opendsm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">odsm</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">opendsm</span><span class="w"> </span><span class="kn">import</span> <span class="n">eemeter</span> <span class="k">as</span> <span class="n">em</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="n">df_baseline</span><span class="p">,</span> <span class="n">df_reporting</span> <span class="o">=</span>  <span class="n">odsm</span><span class="o">.</span><span class="n">test_data</span><span class="o">.</span><span class="n">load_test_data</span><span class="p">(</span><span class="s2">&quot;monthly_treatment_data&quot;</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">15</span>
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="nb">id</span> <span class="o">=</span> <span class="n">df_baseline</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unique</span><span class="p">()[</span><span class="n">n</span><span class="p">]</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="n">df_baseline_n</span> <span class="o">=</span> <span class="n">df_baseline</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="n">df_reporting_n</span> <span class="o">=</span> <span class="n">df_reporting</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>
<a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="n">baseline_data</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingBaselineData</span><span class="p">(</span><span class="n">df_baseline_n</span><span class="p">,</span> <span class="n">is_electricity_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="n">reporting_data</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingReportingData</span><span class="p">(</span><span class="n">df_reporting_n</span><span class="p">,</span> <span class="n">is_electricity_data</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>
<a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disqualifications: </span><span class="si">{</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">disqualification</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warnings:          </span><span class="si">{</span><span class="n">baseline_data</span><span class="o">.</span><span class="n">warnings</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>
<a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="n">billing_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="p">()</span>
<a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">)</span>
<a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>
<a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="c1"># Save model to json</span>
<a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="n">saved_model</span> <span class="o">=</span> <span class="n">billing_model</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="n">loaded_model</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="n">BillingModel</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">saved_model</span><span class="p">)</span>
<a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a>
<a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="c1"># Model results</span>
<a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
<a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="n">billing_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">reporting_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
<a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a>
<a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="n">df_results</span> <span class="o">=</span> <span class="n">billing_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">reporting_data</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s2">&quot;monthly&quot;</span><span class="p">)</span>
<a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;savings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span>
<a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted Usage (kWh):  </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Observed Usage (kWh):   </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Savings (kWh):          </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">df_results</span><span class="p">[</span><span class="s1">&#39;savings&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  OpenDSM a Series of LF Projects, LLC<br> For web site terms of use, trademark policy and other project policies please see <a href="https://lfprojects.org">https://lfprojects.org</a>.
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["content.code.copy", "navigation.sections", "navigation.tabs", "search.highlight", "search.suggest"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://cmp.osano.com/16A0DbT9yDNIaQkvZ/af2b9f1f-3ac7-4a18-a99a-e487d04f08e6/osano.js?variant=two"></script>
      
    
  </body>
</html>